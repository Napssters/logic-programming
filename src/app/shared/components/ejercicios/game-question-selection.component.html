<!-- Seccion de ejemplos -->
<div *ngIf="tipo === 1">
  <div *ngIf="loading" class="text-center py-8">Cargando ejemplos...</div>
  <div *ngIf="error" class="text-red-500 text-center py-8">{{ error }}</div>

  <!-- Selector de ejemplos -->
  <div *ngIf="!ejemploSeleccionado && !loading && !error" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    <div *ngFor="let ejemplo of ejemplos"
      class="card-ejemplo bg-gradient-to-br from-white via-blue-100 to-purple-100 rounded-3xl shadow-xl border border-blue-200 flex flex-col justify-between items-stretch px-6 pt-6 pb-4 h-[22.61180115rem] w-full max-w-md mx-auto transition-all duration-200 hover:scale-105">
      <div class="flex flex-col gap-2 flex-grow">
        <div class="flex items-center mb-4 gap-2">
          <span class="emoji-card text-2xl">{{ getEmojiEjemplo(ejemplo.titulo) }}</span>
          <span class="text-lg font-bold text-gray-800 truncate">{{ ejemplo.titulo }}</span>
        </div>
        <div
          class="bg-gradient-to-br from-blue-50 via-purple-50 to-white border-l-4 border-blue-300 shadow rounded-xl px-2 py-3 w-full mb-2 overflow-auto">
          <p class="text-gray-700 text-sm" style="text-align: justify; white-space: pre-line;">{{ ejemplo.enunciado }}
          </p>
        </div>
      </div>
      <div class="flex flex-col items-center mt-auto">
        <div class="text-xs text-gray-600 mb-2">
          Puntuaci√≥n: <span class="font-bold text-blue-700">{{ puntuacionesEjemplos[ejemplo.id] || 0 }}</span>
          <span class="text-gray-500">/ {{ getMaxScoreForCase(ejemplo) }}</span>
        </div>
        <button
          class="btn-ejemplo w-full bg-gradient-to-r from-blue-400 to-purple-400 text-white font-semibold py-2 px-4 rounded-lg shadow hover:from-blue-500 hover:to-purple-500 transition"
          (click)="seleccionarEjemplo(ejemplo)">Intentar ejemplo</button>
      </div>
    </div>
  </div>

  <!-- Ejemplo en curso -->
  <div *ngIf="ejemploSeleccionado && !finalizadoEjemplo"
    class="game-section w-full max-w-2xl mx-auto flex flex-col items-center justify-center relative gap-6">
    <div class="absolute top-0 left-0 w-full h-full pointer-events-none z-0">
      <div class="game-bg-gradient"></div>
      <div class="game-bg-stars"></div>
    </div>
    <!-- Card: T√≠tulo y enunciado -->
    <div
      class="game-card relative z-10 animate-pop shadow-2xl rounded-3xl px-8 pt-8 pb-6 flex flex-col items-center w-full"
      style="background: linear-gradient(135deg, #fef9c3 0%, #e0e7ff 100%);">
      <div class="flex items-center gap-2 mb-2">
        <span class="emoji-card text-4xl">{{ getEmojiEjemplo(ejemploSeleccionado.titulo) }}‚Äç</span>
        <span class="text-2xl font-extrabold text-pink-700 drop-shadow">{{ ejemploSeleccionado.titulo }}</span>
      </div>
      <p class="mb-2 text-gray-800 text-justify text-lg font-medium w-full max-w-xl">{{ ejemploSeleccionado.enunciado }}
      </p>
    </div>
    <!-- Card: Pregunta y opciones -->
    <div *ngIf="preguntaActualEjemplo < ejemploSeleccionado.preguntas.length"
      class="game-question-card bg-white/80 rounded-xl p-6 shadow-lg border-2 border-pink-300 animate-fade-in w-full">
      <h3 class="font-bold text-pink-700 text-xl mb-4 flex items-center gap-2">
        <span class="emoji-card text-2xl">‚ùì</span>
        {{ ejemploSeleccionado.preguntas[preguntaActualEjemplo].pregunta }}
      </h3>
      <div class="flex flex-wrap gap-4 justify-center">
        <div class="grid grid-cols-2 gap-4 w-full">
          <ng-container *ngFor="let eleccion of ejemploSeleccionado.preguntas[preguntaActualEjemplo].elecciones; let i = index">
            <div class="relative group flex justify-center col-span-2" *ngIf="ejemploSeleccionado.preguntas[preguntaActualEjemplo].elecciones.length % 2 === 1 && i === ejemploSeleccionado.preguntas[preguntaActualEjemplo].elecciones.length - 1">
              <div class="w-full flex justify-center">
                <button
                  class="game-btn-choice mx-auto break-words whitespace-pre-line px-6 py-3 rounded-full font-bold text-lg shadow-lg transition transform hover:scale-110 hover:bg-gradient-to-r hover:from-pink-400 hover:to-yellow-400 bg-gradient-to-r from-pink-400 to-purple-400 text-white border-2 border-white"
                  (click)="responderEjemplo(eleccion)"
                  [attr.aria-describedby]="'tooltip-' + eleccion">
                  {{ eleccion }}
                </button>
              </div>
              <div *ngIf="ejemploSeleccionado.preguntas[preguntaActualEjemplo].consecuencias[eleccion]?.feedback"
                class="absolute left-1/2 -translate-x-1/2 top-full mt-2 z-20 px-3 py-2 rounded-lg bg-pink-700 text-white text-sm font-medium shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-pre-line min-w-[10rem] max-w-xs"
                [id]="'tooltip-' + eleccion">
                {{ ejemploSeleccionado.preguntas[preguntaActualEjemplo].consecuencias[eleccion]?.feedback }}
              </div>
            </div>
            <div class="relative group flex justify-center col-span-1" *ngIf="!(ejemploSeleccionado.preguntas[preguntaActualEjemplo].elecciones.length % 2 === 1 && i === ejemploSeleccionado.preguntas[preguntaActualEjemplo].elecciones.length - 1)">
              <div class="w-full flex justify-center">
                <button
                  class="game-btn-choice w-full break-words whitespace-pre-line px-6 py-3 rounded-full font-bold text-lg shadow-lg transition transform hover:scale-110 hover:bg-gradient-to-r hover:from-pink-400 hover:to-yellow-400 bg-gradient-to-r from-pink-400 to-purple-400 text-white border-2 border-white"
                  (click)="responderEjemplo(eleccion)"
                  [attr.aria-describedby]="'tooltip-' + eleccion">
                  {{ eleccion }}
                </button>
              </div>
              <div *ngIf="ejemploSeleccionado.preguntas[preguntaActualEjemplo].consecuencias[eleccion]?.feedback"
                class="absolute left-1/2 -translate-x-1/2 top-full mt-2 z-20 px-4 py-3 rounded-lg bg-pink-700 text-white text-sm font-medium shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-pre-line min-w-[16rem] max-w-lg"
                [id]="'tooltip-' + eleccion">
                {{ ejemploSeleccionado.preguntas[preguntaActualEjemplo].consecuencias[eleccion]?.feedback }}
              </div>
            </div>
          </ng-container>
        </div>
      </div>
    </div>
    <!-- Card: Progreso y puntuaci√≥n -->
    <div
      class="game-status-card bg-white/80 rounded-xl px-6 py-4 shadow-lg border-2 border-pink-300 flex justify-between items-center w-full max-w-md animate-fade-in">
      <div class="text-sm text-pink-600 font-bold">Pregunta <span class="text-base">{{ preguntaActualEjemplo + 1
          }}</span> /
        <span class="text-base">{{ ejemploSeleccionado.preguntas.length }}</span>
      </div>
      <div class="text-pink-600 font-extrabold text-lg flex items-center gap-1">
        <span class="emoji-card text-xl">‚≠ê</span> {{ puntuacionEjemplo }}
        <span class="text-gray-500">/ {{ getMaxScoreForCase(ejemploSeleccionado) }}</span>
      </div>
    </div>
  </div>

  <!-- Ejemplo finalizado -->
  <div *ngIf="finalizadoEjemplo"
    class="w-full max-w-2xl mx-auto flex flex-col items-center justify-center relative gap-6">
    <div class="relative z-10 animate-pop shadow-2xl rounded-3xl px-8 pt-8 pb-6 flex flex-col items-center w-full mb-4"
      style="background: linear-gradient(135deg, #b6c7ff 0%, #f3f4f6 100%);">
      <div class="flex items-center gap-2 mb-4">
        <span class="emoji-card text-4xl">üèÜ</span>
        <span class="text-2xl font-extrabold text-blue-700 drop-shadow">¬°Ejemplo completado!</span>
      </div>
      <p class="mb-4 text-gray-800 text-lg font-medium w-full max-w-xl text-center">{{ resultadoEjemplo }}</p>
      <button
        class="bg-gradient-to-r from-blue-200 to-purple-200 hover:from-blue-300 hover:to-purple-300 text-gray-800 font-semibold py-3 px-8 rounded-full shadow-xl transition transform hover:scale-105 mt-2"
        (click)="reiniciarEjemplo()">Volver al selector de ejemplos</button>
    </div>
  </div>
</div>

<!-- Seccion Ejercicios -->
<div *ngIf="tipo === 2">
  <div *ngIf="loading" class="text-center py-8">Cargando ejercicios...</div>
  <div *ngIf="error" class="text-red-500 text-center py-8">{{ error }}</div>

  <!-- Selector de ejercicios -->
  <div *ngIf="!ejercicioSeleccionado && !loading && !error"
    class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    <div *ngFor="let ejercicio of ejercicios"
      class="card-ejercicio bg-gradient-to-br from-white via-blue-100 to-green-200 rounded-2xl shadow-xl border border-green-300 flex flex-col justify-between items-stretch px-5 pt-7 pb-5 h-[26.5335rem] w-full max-w-md mx-auto transition-all duration-200 hover:scale-105">
      <div class="flex flex-col gap-2 flex-grow">
        <div class="flex items-center mb-4 gap-2">
          <span class="emoji-card text-2xl">{{ getEmoji(ejercicio.titulo) }}</span>
          <span class="text-lg font-bold text-gray-800 truncate">{{ ejercicio.titulo }}</span>
        </div>
        <div
          style="background: linear-gradient(135deg, #b1eef6 0%, #e0e7ff 100%); border-left: 4px solid #38b2ac; box-shadow: 0 2px 8px rgba(59,130,246,0.10); border-radius: 1rem; padding: 1rem 0.5rem; width: 100%; margin-bottom: 0.5rem; overflow: auto;">
          <p class="text-gray-700 text-sm" style="text-align: justify; white-space: pre-line;">{{ ejercicio.enunciado }}
          </p>
        </div>
      </div>
      <div class="flex flex-col items-center mt-auto">
        <div class="text-xs text-gray-600 mb-2">
          Puntuaci√≥n: <span class="font-bold text-yellow-700">{{ puntuacionesEjercicios[ejercicio.id] || 0 }}</span>
          <span class="text-gray-500">/ {{ getMaxScoreForCase(ejercicio) }}</span>
        </div>
        <button
          class="btn-ejercicio w-full bg-gradient-to-r from-green-500 to-blue-400 text-white font-semibold py-2 px-4 rounded-lg shadow hover:from-green-600 hover:to-blue-500 transition"
          (click)="seleccionarEjercicio(ejercicio)">Intent√©moslo</button>
      </div>
    </div>
  </div>


  <!-- Ejercicio en curso - Estilo juego mejorado -->
  <div *ngIf="ejercicioSeleccionado && !finalizado"
    class="game-section w-full max-w-2xl mx-auto flex flex-col items-center justify-center relative gap-6">
    <div class="absolute top-0 left-0 w-full h-full pointer-events-none z-0">
      <div class="game-bg-gradient"></div>
      <div class="game-bg-stars"></div>
    </div>
    <!-- Card: T√≠tulo y enunciado -->
    <div
      class="game-card relative z-10 animate-pop shadow-2xl rounded-3xl px-8 pt-8 pb-6 flex flex-col items-center w-full"
      style="background: linear-gradient(135deg, #fef9c3 0%, #e0e7ff 100%);">
      <div class="flex items-center gap-2 mb-2">
        <span class="emoji-card text-4xl">{{ getEmoji(ejercicioSeleccionado.titulo) }}</span>
        <span class="text-2xl font-extrabold text-purple-700 drop-shadow">{{ ejercicioSeleccionado.titulo }}</span>
      </div>
      <p class="mb-2 text-gray-800 text-justify text-lg font-medium w-full max-w-xl">{{ ejercicioSeleccionado.enunciado
        }}
      </p>
    </div>
    <!-- Card: Pregunta y opciones -->
    <div *ngIf="preguntaActual < ejercicioSeleccionado.preguntas.length"
      class="game-question-card bg-white/80 rounded-xl p-6 shadow-lg border-2 border-yellow-300 animate-fade-in w-full">
      <h3 class="font-bold text-blue-700 text-xl mb-4 flex items-center gap-2">
        <span class="emoji-card text-2xl">‚ùì</span>
        {{ ejercicioSeleccionado.preguntas[preguntaActual].pregunta }}
      </h3>
      <div class="flex flex-wrap gap-4 justify-center">
        <button *ngFor="let eleccion of ejercicioSeleccionado.preguntas[preguntaActual].elecciones"
          class="game-btn-choice px-6 py-3 rounded-full font-bold text-lg shadow-lg transition transform hover:scale-110 hover:bg-gradient-to-r hover:from-yellow-400 hover:to-pink-400 bg-gradient-to-r from-blue-400 to-purple-400 text-white border-2 border-white"
          (click)="responder(eleccion)">
          {{ eleccion }}
        </button>
      </div>
    </div>
    <!-- Card: Progreso y puntuaci√≥n -->
    <div
      class="game-status-card bg-white/80 rounded-xl px-6 py-4 shadow-lg border-2 border-purple-300 flex justify-between items-center w-full max-w-md animate-fade-in">
      <div class="text-sm text-pink-600 font-bold">Pregunta <span class="text-base">{{ preguntaActual + 1 }}</span> /
        <span class="text-base">{{ ejercicioSeleccionado.preguntas.length }}</span>
      </div>
      <div class="text-green-600 font-extrabold text-lg flex items-center gap-1">
        <span class="emoji-card text-xl">‚≠ê</span> {{ puntuacion }}
        <span class="text-gray-500">/ {{ getMaxScoreForCase(ejercicioSeleccionado) }}</span>
      </div>
    </div>
  </div>

  <!-- Ejercicio finalizado -->
  <div *ngIf="finalizado" class="w-full max-w-2xl mx-auto flex flex-col items-center justify-center relative gap-6">
    <div class="relative z-10 animate-pop shadow-2xl rounded-3xl px-8 pt-8 pb-6 flex flex-col items-center w-full mb-4"
      style="background: linear-gradient(135deg, #94efb5 0%, #f3f4f6 100%);">
      <div class="flex items-center gap-2 mb-4">
        <span class="emoji-card text-4xl">üèÜ</span>
        <span class="text-2xl font-extrabold text-green-700 drop-shadow">¬°Ejercicio completado!</span>
      </div>
      <p class="mb-4 text-gray-800 text-lg font-medium w-full max-w-xl text-center">{{ resultado }}</p>
      <button
        class="bg-gradient-to-r from-green-200 to-blue-200 hover:from-green-300 hover:to-blue-300 text-gray-800 font-semibold py-3 px-8 rounded-full shadow-xl transition transform hover:scale-105 mt-2"
        (click)="reiniciar()">Volver al selector de ejercicios</button>
    </div>
  </div>
</div>
