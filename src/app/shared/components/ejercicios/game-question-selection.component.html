<div *ngIf="loading" class="text-center py-8">Cargando ejercicios...</div>
<div *ngIf="error" class="text-red-500 text-center py-8">{{ error }}</div>

<!-- Selector de ejercicios -->
<div *ngIf="!ejercicioSeleccionado && !loading && !error" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
  <div *ngFor="let ejemplo of ejemplos"
    class="card-ejercicio bg-gradient-to-br from-white via-gray-100 to-yellow-400 rounded-3xl shadow-2xl border border-yellow-200 flex flex-col justify-between items-stretch px-6 pt-8 pb-6 h-[30rem] w-full max-w-lg mx-auto transition-all duration-200 hover:scale-105">
    <div class="flex flex-col gap-2 flex-grow">
      <div class="flex items-center mb-4 gap-2">
        <span class="emoji-card text-2xl">{{ getEmoji(ejemplo.titulo) }}</span>
        <span class="text-lg font-bold text-gray-800 truncate">{{ ejemplo.titulo }}</span>
      </div>
      <div
        class="bg-gradient-to-br from-yellow-100 via-yellow-50 to-white border-l-4 border-yellow-400 shadow-lg rounded-xl px-2 py-4 w-full mb-2 overflow-auto">
        <p class="text-gray-700 text-sm" style="text-align: justify; white-space: pre-line;">{{ ejemplo.enunciado }}</p>
      </div>
    </div>
    <div class="flex flex-col items-center mt-auto">
      <div class="text-xs text-gray-600 mb-2">Puntuación: <span class="font-bold text-yellow-700">{{
          puntuacionesEjercicios[ejemplo.id] || 0 }}</span></div>
      <button class="btn-ejercicio w-full" (click)="seleccionarEjercicio(ejemplo)">Intentémoslo</button>
    </div>
  </div>
</div>


<!-- Ejercicio en curso - Estilo juego mejorado -->
<div *ngIf="ejercicioSeleccionado && !finalizado"
  class="game-section w-full max-w-2xl mx-auto flex flex-col items-center justify-center relative gap-6">
  <div class="absolute top-0 left-0 w-full h-full pointer-events-none z-0">
    <div class="game-bg-gradient"></div>
    <div class="game-bg-stars"></div>
  </div>
  <!-- Card: Título y enunciado -->
  <div
    class="game-card relative z-10 animate-pop shadow-2xl rounded-3xl px-8 pt-8 pb-6 flex flex-col items-center w-full"
    style="background: linear-gradient(135deg, #fef9c3 0%, #e0e7ff 100%);">
    <div class="flex items-center gap-2 mb-2">
      <span class="emoji-card text-4xl">🎮</span>
      <span class="text-2xl font-extrabold text-purple-700 drop-shadow">{{ ejercicioSeleccionado.titulo }}</span>
    </div>
    <p class="mb-2 text-gray-800 text-justify text-lg font-medium w-full max-w-xl">{{ ejercicioSeleccionado.enunciado }}
    </p>
  </div>
  <!-- Card: Pregunta y opciones -->
  <div *ngIf="preguntaActual < ejercicioSeleccionado.preguntas.length"
    class="game-question-card bg-white/80 rounded-xl p-6 shadow-lg border-2 border-yellow-300 animate-fade-in w-full">
    <h3 class="font-bold text-blue-700 text-xl mb-4 flex items-center gap-2">
      <span class="emoji-card text-2xl">❓</span>
      {{ ejercicioSeleccionado.preguntas[preguntaActual].pregunta }}
    </h3>
    <div class="flex flex-wrap gap-4 justify-center">
      <button *ngFor="let eleccion of ejercicioSeleccionado.preguntas[preguntaActual].elecciones"
        class="game-btn-choice px-6 py-3 rounded-full font-bold text-lg shadow-lg transition transform hover:scale-110 hover:bg-gradient-to-r hover:from-yellow-400 hover:to-pink-400 bg-gradient-to-r from-blue-400 to-purple-400 text-white border-2 border-white"
        (click)="responder(eleccion)">
        {{ eleccion }}
      </button>
    </div>
  </div>
  <!-- Card: Progreso y puntuación -->
  <div
    class="game-status-card bg-white/80 rounded-xl px-6 py-4 shadow-lg border-2 border-purple-300 flex justify-between items-center w-full max-w-md animate-fade-in">
    <div class="text-sm text-pink-600 font-bold">Pregunta <span class="text-base">{{ preguntaActual + 1 }}</span> /
      <span class="text-base">{{ ejercicioSeleccionado.preguntas.length }}</span></div>
    <div class="text-green-600 font-extrabold text-lg flex items-center gap-1">
      <span class="emoji-card text-xl">⭐</span> {{ puntuacion }}
    </div>
  </div>
</div>

<!-- Ejercicio finalizado -->
<div *ngIf="finalizado" class="w-full max-w-2xl mx-auto flex flex-col items-center justify-center relative gap-6">
  <div class="absolute top-0 left-0 w-full h-full pointer-events-none z-0">
    <div class="game-bg-gradient"></div>
    <div class="game-bg-stars"></div>
  </div>
  <div class="relative z-10 animate-pop shadow-2xl rounded-3xl px-8 pt-8 pb-6 flex flex-col items-center w-full mb-4"
    style="background: linear-gradient(135deg, #bbf7d0 0%, #e0e7ff 100%);">
    <div class="flex items-center gap-2 mb-4">
      <span class="emoji-card text-4xl">🏆</span>
      <span class="text-2xl font-extrabold text-green-700 drop-shadow">¡Ejercicio completado!</span>
    </div>
    <p class="mb-4 text-gray-800 text-lg font-medium w-full max-w-xl text-center">{{ resultado }}</p>
    <button class="bg-gradient-to-r from-blue-400 to-purple-400 hover:from-blue-500 hover:to-purple-500 text-white font-semibold py-3 px-8 rounded-full shadow-xl transition transform hover:scale-105 mt-2"
      (click)="reiniciar()">Volver al selector de ejercicios</button>
  </div>
</div>
