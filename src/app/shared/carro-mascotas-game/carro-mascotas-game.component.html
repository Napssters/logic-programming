<div class="container" *ngIf="nivelActual">

  <header class="header">
    <h1 class="title">Carro Recolector</h1>
    <p class="level-indicator">Nivel {{ indiceNivel + 1 }}: {{ nivelActual.nombre }}</p>
  </header>

  <div class="game-area">
    <div style="display: flex; flex-direction: column;">
  <div style="width: 621px; height: 560px; display: flex; justify-content: center; align-items: center; background: linear-gradient(135deg, #36D1DC, #5B86E5); border-radius: 15px; border: 1px solid rgba(255, 255, 255, 0.2); box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);">
        <main class="game-board" [ngStyle]="getGridStyles()">

        <!-- Celdas del mapa -->

        <div *ngFor="let cell of flatLayout; let i = index"
             [class]="'cell ' + cell.type + ' ' + cell.orientation"
             [ngStyle]="cell.isOptimal ? {'background-color': '#22c55e'} : {}">

          <!-- Elementos del juego en la celda con color de fondo -->
          <div *ngIf="cell.entity === 'house'" class="game-element house"
            [ngStyle]="{'background-color': getEntityColor(cell), 'display': 'flex', 'align-items': 'center', 'justify-content': 'center'}">
            <span
              style="font-size:2.2rem; display: flex; align-items: center; justify-content: center; width: 100%; height: 100%;">üè†</span>
          </div>
          <div *ngIf="cell.entity === 'pet'" class="game-element pet"
            [ngStyle]="{'background-color': getEntityColor(cell), 'display': 'flex', 'align-items': 'center', 'justify-content': 'center'}">
            <span
              style="font-size:2.2rem; display: flex; align-items: center; justify-content: center; width: 100%; height: 100%;">{{
              getEmojiAnimal(cell.entityName) }}</span>
          </div>
        </div>

        <!-- Carro (elemento m√≥vil) sin fondo -->
        <div class="game-element car" [ngStyle]="getCarStyles()">
          <span style="font-size:2.2rem; background: none;">{{ getEmojiCarro() }}</span>
        </div>

        <!-- Overlay para mensajes -->
        <div *ngIf="mensaje" class="message-overlay">
          <div style="min-width:320px; max-width:90vw; padding:2.5rem 2rem 2rem 2rem; background:linear-gradient(135deg, #36D1DC, #5B86E5); border-radius: 1.5rem; box-shadow: 0 4px 30px rgba(0,0,0,0.15); border: 1px solid rgba(255,255,255,0.25); display:flex; flex-direction:column; align-items:center; justify-content:center;">
            <h2 style="color:#fff; font-size:2rem; font-weight:700; text-align:center; margin-bottom:1.5rem; text-shadow:0 2px 8px rgba(0,0,0,0.10); font-family:var(--font-display);">{{ mensaje }}</h2>
            <div style="display:flex; flex-direction:row; gap:1.2rem; align-items:center; justify-content:center; margin-top:0.5rem;">
              <div style="display:flex; flex-direction:column; align-items:center; position:relative;">
                <div class="tooltip-reiniciar" style="pointer-events:none; opacity:0; position:absolute; left:50%; top:-1.7rem; transform:translateX(-50%); background:#111; color:#fff; font-size:0.78rem; padding:0.13rem 0.7rem; border-radius:0.35rem; font-weight:500; box-shadow:0 2px 8px rgba(0,0,0,0.10); white-space:nowrap; transition:opacity 0.18s; z-index:10;">Reiniciar</div>
                <button (click)="reiniciarNivel()"
                  style="width:48px; height:48px; display:flex; align-items:center; justify-content:center; border-radius:50%; border:none; background:linear-gradient(135deg, #22c55e, #38bdf8); color:#fff; box-shadow:0 2px 12px rgba(0,0,0,0.10); transition:transform 0.15s; cursor:pointer; outline:none; font-size:1.3rem; position:relative;"
                  onmouseover="this.style.transform='scale(1.12)'; this.previousElementSibling.style.opacity='1'"
                  onmouseout="this.style.transform='scale(1)'; this.previousElementSibling.style.opacity='0'">
                  <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                  </svg>
                </button>
              </div>
              <div style="display:flex; flex-direction:column; align-items:center; position:relative;">
                <div class="tooltip-sig-nivel" style="pointer-events:none; opacity:0; position:absolute; left:50%; top:-1.7rem; transform:translateX(-50%); background:#111; color:#fff; font-size:0.78rem; padding:0.13rem 0.7rem; border-radius:0.35rem; font-weight:500; box-shadow:0 2px 8px rgba(0,0,0,0.10); white-space:nowrap; transition:opacity 0.18s; z-index:10;">Siguiente Nivel</div>
                <button (click)="siguienteNivel()"
                  style="background:linear-gradient(135deg, #22c55e, #38bdf8); color:#fff; border:none; border-radius:2rem; padding:0.75rem 2.9rem; box-shadow:0 2px 12px rgba(0,0,0,0.10); transition:transform 0.15s; cursor:pointer; outline:none; display:flex; align-items:center; justify-content:center; gap:0.7rem; font-size:1.1rem; position:relative;"
                  onmouseover="this.style.transform='scale(1.07)'; this.previousElementSibling.style.opacity='1'"
                  onmouseout="this.style.transform='scale(1)'; this.previousElementSibling.style.opacity='0'">
                  <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                  </svg>
                </button>
              </div>
            </div>
          </div>
        </div>

      </main>
      </div>
      <div style="display: flex; justify-content: flex-end; padding-top: 1rem;">
        <div style="display:flex; gap:1rem; background:linear-gradient(135deg, #36D1DC, #5B86E5); border-radius:1.5rem; box-shadow:0 4px 24px rgba(0,0,0,0.08); padding:1.2rem 1.5rem;">
          <!-- Anterior -->
          <div class="group" style="position:relative;">
            <button (click)="anteriorNivel()"
              class="satellite-btn w-12 h-12 text-white rounded-full shadow-lg hover:shadow-xl transition-all duration-300 ease-in-out flex items-center justify-center border-2 animate-in hover:scale-110"
              style="background-color:#f3ae22;border-color:#d18c00;"
              [disabled]="false">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
              </svg>
            </button>
            <div class="absolute -top-8 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap z-10">
              Anterior
              <div class="absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-2 border-r-2 border-t-2 border-transparent border-t-gray-800"></div>
            </div>
          </div>
          <!-- Reiniciar -->
          <div class="group" style="position:relative;">
            <button (click)="reiniciarNivel()"
              class="satellite-btn w-12 h-12 text-white rounded-full shadow-lg hover:shadow-xl transition-all duration-300 ease-in-out flex items-center justify-center border-2 animate-in hover:scale-110"
              style="background-color:#22c55e;border-color:#15803d;">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
              </svg>
            </button>
            <div class="absolute -top-8 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap z-10">
              Reiniciar
              <div class="absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-2 border-r-2 border-t-2 border-transparent border-t-gray-800"></div>
            </div>
          </div>
          <!-- Ruta √≥ptima -->
          <div class="group" style="position:relative;" *ngIf="esEjemplo()">
            <button (click)="toggleRuta()"
              class="satellite-btn w-12 h-12 text-white rounded-full shadow-lg hover:shadow-xl transition-all duration-300 ease-in-out flex items-center justify-center border-2 animate-in hover:scale-110"
              style="background-color:#38bdf8;border-color:#0ea5e9;">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z"></path>
                <circle cx="12" cy="9" r="2.5"/>
              </svg>
            </button>
            <div class="absolute -top-8 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap z-10">
              Ruta √≥ptima
              <div class="absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-2 border-r-2 border-t-2 border-transparent border-t-gray-800"></div>
            </div>
          </div>
          <!-- Siguiente -->
          <div class="group" style="position:relative;">
            <button (click)="siguienteNivel()"
              class="satellite-btn w-12 h-12 text-white rounded-full shadow-lg hover:shadow-xl transition-all duration-300 ease-in-out flex items-center justify-center border-2 animate-in hover:scale-110"
              style="background-color:#2563eb;border-color:#1e40af;">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
              </svg>
            </button>
            <div class="absolute -top-8 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap z-10">
              Siguiente
              <div class="absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-2 border-r-2 border-t-2 border-transparent border-t-gray-800"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <aside class="sidebar">
      <div class="info-box">
        <h3>Gasolina</h3>
        <p class="value">{{ gasolinaRestante }}</p>
      </div>

      <div class="info-box">
        <h3>Controles</h3>
        <p class="controls-info">Usa las <strong>flechas</strong> del teclado para moverte.</p>
      </div>

      <div class="info-box">
        <h3>Mascotas</h3>
        <p *ngIf="mascotasRecogidas.length === 0">Ninguna a bordo</p>
        <span *ngFor="let pet of mascotasRecogidas" class="value"
          [ngStyle]="{'background-color': getColorCasaMascota(pet), 'border-radius':'0.35em', 'padding':'0.08em 0.32em', 'margin-right':'0.18em', 'display':'inline-block', 'font-size':'1.45rem'}">
          {{ getEmojiAnimal(pet) }}
        </span>
      </div>

    </aside>
  </div>


</div>
